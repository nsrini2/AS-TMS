<% content_for(:page_title, "Manage Members for #{@sponsor_account.name} Sponsor Account") -%>

<h2><%= @sponsor_account.name %> Sponsor Members </h2>
<a href="<%= sponsor_accounts_path -%>">&laquo; Back to Sponsor Accounts</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="<%= sponsor_account_sponsor_groups_path(@sponsor_account) -%>">Manage <% @sponsor_account.name -%> Groups</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="<%= new_sponsor_account_sponsor_member_url(@sponsor_account) %>">Create a new Sponsor Member</a><br />
<% @sponsor_account.sponsors.each_index do |index| -%>
<% sponsor = @sponsor_account.sponsors[index] -%>
<% klass = index%2 != 0 ? 'even' : 'odd' -%>
<div class="sponsor_account_sponsor sponsor_account_sponsor_<%= klass %>">
	<h3><%= sponsor.full_name %></h3>
	<p>

	</p>
	<div class="container">
		<% form_for :sponsor_member, :url => add_group_sponsor_account_sponsor_member_path(@sponsor_account, sponsor) do |f| -%>
			<label for="add_group_<%= "#{sponsor.id}" %>">Add to a group:</label>
			<% account_groups = @sponsor_account.groups.to_set.subtract(sponsor.groups).collect { |s| ["#{s.name}", s.id] } %>
			<%= select(:group, :id, account_groups, { :prompt => 'Select Group' }, {:id => "add_group_#{sponsor.id}", :disabled => account_groups.size > 0 ? false : true } ) -%>
			<%= account_groups.size > 0 ? submit_tag("Add to Group") : "<a href=\"#{new_sponsor_account_sponsor_group_path(@sponsor_account)} \">Create a group</a>" %>
		<% end -%>
		<% form_for :sponsor_member, :url => remove_group_sponsor_account_sponsor_member_path(@sponsor_account, sponsor) do |f| -%>
			<label for="remove_group_<%= "#{sponsor.id}" %>">Remove from a group:</label>
			<% sponsor_member_groups = sponsor.groups.exclude_groups(sponsor).collect { |s| ["#{s.name}", s.id] } %>
			<%= select(:group, :id, sponsor_member_groups, { :prompt => 'Select Group' }, {:id => "remove_group_#{sponsor.id}", :disabled => sponsor_member_groups.size > 0 ? false : true }) -%>
			<%= submit_tag "Remove from Group", :disabled => sponsor_member_groups.size > 0 ? false : true %>
		<% end -%>
		<br />
		<ul class="action_list">
			<li><a href="<%= groups_profile_path(sponsor) %>"><%= pluralize(sponsor.groups.size, "group") %></a></li>
			<li><a href="<%= profile_path(sponsor) %>">View Profile</a></li>
			<li><a href="<%= edit_sponsor_member_path(sponsor) %>">Edit Details</a></li>
			<li><a href="<%= reset_password_sponsor_member_path(sponsor) %>">Reset Password</a></li>
			<% if sponsor.user.locked? -%>
			<li><a href="<%= unlock_sponsor_member_path(sponsor) %>">Clear Lock</a></li>
			<% end -%>
		</ul>
	</div>
</div>
<% end -%>
