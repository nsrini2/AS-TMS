<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>AgentStream</title>
	<link rel="stylesheet" href="/themes/agentstream/_css/style.css" />

	<%= javascript_tag "var AUTH_TOKEN = #{form_authenticity_token.inspect};" if protect_against_forgery? -%>


</head>
<body>
<div id="page">
	<div id="header">
		<h1 id="logo"><%= link_to "AgentStream", home_path %></h1>
		<div class="global_nav">
			<ul class="nav">
				<%= global_nav_link "Community", '/' %>
				<%= global_nav_link "Questions", questions_explorations_path %>
				<%= global_nav_link "Groups", groups_explorations_path %>
				<%= global_nav_link "Blogs", blogs_explorations_path %>
			</ul>
		</div>
		<div class="utility">
			<ul class="nav">
				<li>
				  <span class="online_now"><%= @active_users %> online now</span>
				</li>
				<li>
				  <%= link_to "Home", home_path %>
				</li>
				<li>
				  <%= link_to "Profile", profile_path(current_profile) if current_profile %>
				</li>
				<li>
				  <%= link_to("Account", (hide_for_sponsor ? change_email_account_path : email_subscriptions_account_path), :class => "#{@content_for_settings_selected} drop_down") if current_profile %>
				</li>
			</ul>
			<div class="search">
				<form action="/search" method="get" accept-charset="utf-8">
					<input type="text" name="q" size="40" placeholder="Search for any keyword or person" />
			    <button type="submit">Search</button>
				</form>
			</div>
		</div>
	</div>

	<div id="main">
	  <div id="primary">

      <%#= yield %>
		  <%= @content_for_content ? yield(:content) : yield %>
		
		</div>
	</div>
	<%= render :partial => "/shared/footer" %>
</div>
<!-- 
  MM2:
  REVERTING BACK TO THE OLD JAVASCRIPT WAYS.
  IF ANYONE HAS THE TIME/EFFORT TO WRITE ONLY THE ONES WE NEED, I'M OPEN TO IT.

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write('<script src="js/jquery-1.4.2.min.js"><\/script>')</script>
  <script src="/themes/agentstream/_js/script.js"></script>
  <script type="text/javascript" charset="utf-8">
  (function($) {  // $ = jQuery within this block


  $(document).ready(function() {

     $('.alert .close').live('click', function(event) {
       $(this).parent().fadeTo('slow', 0.01, function(){$(this).slideUp();});
       return false;
     });
  });
  })(jQuery);
  </script>
-->



  <%= javascript_include_merged( :base ) -%>
  <%= javascript_include_merged( :admin ) if @content_for_admin_js -%>

  <% # There were issues with including ckeditor in the asset packager %>
  <%= javascript_include_tag "ckeditor/ckeditor" %>
  
  <!-- OK THIS DOES NEED A FILE HOME -->
  <script type="text/javascript" charset="utf-8">
    // Helper functions 
    
    // // OVERRIDES THE METHOD IN GLOBAL.JS
    // function update_status_widget(data) {
    //   window.location = window.location;
    // }
  </script>

  <!-- AS DO THESE! -->
  <script type="text/javascript" charset="utf-8">  
  
    (function($) {  // $ = jQuery within this block
      
    	$(document).ready(function() {

    		$('.alert .close').live('click', function(event) {
    		  $(this).parent().fadeTo('slow', 0.01, function(){$(this).slideUp();});
    		  return false;
    		}),

    		$('div.tabs ul.tabs-nav li a').live('click', function(event) {
    			var $this = $(this);

          // Allow for standard tabs
          if($this.parent().parent().hasClass('standard')) {
            window.location = $this.attr('href');
          }
          else {
      			// Toggle the tab links
      			$('.tabs ul.tabs-nav li').removeClass('active');
      			$this.parent().addClass('active');

      			// Toggle the tab containers
      			$('div.tabs-panel').hide();
      			$('div' + $this.attr('href')).show();

      			return false;
      		}
    		}),
    		
    		$('input#status_question').live('click', function(event) {
    		  $this = $(this);
    		  
    		  $form = $('form#widget_status');
    		  
    		  if($this.attr('checked')) {
    		    $form.attr('action', '/questions');
    		    $('select#status_question_category').show();
    		    
    		    $('textarea#status_body').attr('maxlength', '4000');
    		  }
    		  else {
    		    $form.attr('action', '/statuses');
    		    $('select#status_question_category').hide();
    		    
    		    $('textarea#status_body').attr('maxlength', '140');
    		  }
    		});
    	});
    	
    	$.fn.extend({    	
      	// Status
      	update_status_widget: function(data) {
      		$('#status_body').val("");
      		
      		// More than just reload...clear out all the values
      		// window.location.reload();
      		window.location = window.location;
      	},
  	  });
    })(jQuery);  
  </script>
</body>
</html>