<style>
  /*	news feed */
  #feeds { background: #fff; margin: 0 0 10px; }
  	#feeds .tabs-panel { padding: 10px 0; }
  		#news_feed .news_item { clear: both; margin: 20px 0 0; color: #4a6970; padding: 10px; }
  		#news_feed .question { background: #e1ecee }
  			#news_feed .news_item:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }
  		#news_feed .news_item .photo_wrapper { display: block; float: left; margin: 0 15px 0 0; }
  		#news_feed .news_item .details { display: block; float: left; width: 420px;}
  			#news_feed .news_item .details h3 { margin: 0 6px 0 0; display: inline; font-weight: bold; }
  			#news_feed .news_item .details p { display: inline; }
  			#news_feed .news_item .details p.what { font-size: 14px; }
  			#news_feed .news_item .details p.what span { font-size: 12px;}
  			#news_feed .news_item h3 a { color: #4a6970; }

  #feeds #ask { clear: both; margin: 15px 0 0; color: #4a6970; padding: 0 10px; }
  	#feeds #ask .photo_wrapper { display: block; float: left; margin: 1px 0 0 0; }
  	#feeds #ask:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }
  	#feeds #ask textarea { height: 60px; width: 415px; padding: 10px; border: 1px solid #90b4bc; border-width: 1px 1px 1px 0; font-size: 12px; color: #4a6970; }
  	#feeds #ask img { border: 1px solid #90b4bc; border-width: 1px 0 1px 1px; }
  	#feeds #ask .button { float: right; margin: 0 2px 0 0; background: #90b4bc; border: 0; padding: 5px 25px; color: #fff; font-size: 18px; text-transform: uppercase; font-weight: bold; }


  /* feeds */ /* STOLEN FROM news feed...made to be generic */
  #feeds { background: #fff; margin: 0 0 10px; }
  	#feeds .tabs-panel { padding: 10px 0; }
  		.tabs-panel .news_item { clear: both; margin: 20px 0 0; color: #4a6970; padding: 10px; }
  		.tabs-panel .question { background: #e1ecee }
  			.tabs-panel .news_item:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }
  		.tabs-panel .news_item .photo_wrapper { display: block; float: left; margin: 0 15px 0 0; }
  		.tabs-panel .news_item .details { display: block; float: left; width: 420px;}
  			.tabs-panel .news_item .details h3 { margin: 0 10px 0 0; display: inline; font-weight: bold; }
  			.tabs-panel .news_item .details p { display: inline; }
  			.tabs-panel .news_item h3 a { color: #4a6970; }

			
  /*groups*/
  #groups { position: relative; background-color: #eff8fa; }
  .group_item { clear: both;}
  .group_item:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }
  	#groups .group_item .photo_wrapper { display: block; float: left; margin: 0 15px 0 0; }
  	#hub #groups .details { display: block; float: left; width: 410px;}
  		#groups .group_item .details h3 { margin-bottom: 0px; }
  		#groups .group_item .details h3 small { font-size: 0.8em; }
/*      #groups h3 a { color: #6f563b; }*/
  		#groups h3 .info { color: #987d72; }

  #groups h2 { float: left; }
  #groups .nav { display: block; float: right; margin: 0 0; font-size: 16px; text-transform: lowercase; }
  	#groups .nav:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }
  	#groups .nav li { display: block; float: left; margin: 0 20px 0 0; }
  		#groups .nav li.active { border-bottom: 1px solid #4a6970; }
  	#groups .nav a { color: #4a6970; font-weight: normal;  }
	
  	#statistics table { width: 100%;}
  	#statistics table, #statistics table a { color: #4a6970; }
  	#header, #main { border: 1px solid #c4d7dc; border-width: 0 1px 0; }
  	#main { border-width: 0 1px 1px;}
  	#footer { clear: both; }
  	.aside .module, .primary .module { margin: 0; padding: 10px 20px 10px; border: 1px solid #c4d7dc; border-width: 1px 0 0 0; background: #e5f1f4;}
  	.aside .module { border-width: 1px 0 0 1px; }
  		.aside .last { border-bottom: 1px solid #c4d7dc; }
	
  .question { margin: 0 0 10px; }
  .question .text { margin: 0 0 10px; }
  .question .meta a { color: #90b4bc; }
  .question .meta p { margin: 0;}
  .question .question_actions { margin: 5px 0 0 0;}
  .question .question_actions li { margin: 0 15px 0 0; text-transform: capitalize; }
  .question .question_actions a { 
    background: none;
    color: #676767; 
    font-size: 100%;
    font-weight: normal;
    text-transform: lowercase;
  }



  #promotions { padding: 0; height: 150px; position: relative; }
   #promotions h2 { position: absolute; top: 10px; left: 15px; z-index: 2; color: #fff; text-shadow: #999 0 -1px 0;}
  .promo_image { position: absolute; }
  
  #ask span.counter {
    /*color: #990000;*/
    display: block ! important;
    float: left;
    margin: 0 0 0 -80px;    
  }
  #ask p.actions {
    margin-top: 1px;
    margin-left: 250px;
  }
  #ask p.actions input[type=checkbox] {
    float: left;
    height: 18px;
    margin: 0 2px 0 0;
    width: 18px;
  }
  #ask p.actions span {
    display: block;
    float: left;
    font-size: 1.2em;
  }
  #ask p.actions select {
    margin: 2px 0 0 0;
  }
  
  #following .list {
    margin: 10px;
  }
  
  div.news_item div.details a.new_message.button {
    color: #fff;
  }
</style>


<% if @system_announcement && cookies["system_announcement_updated_at"] != @system_announcement.updated_at.to_s %>
  <%= render :partial => "system_announcements/system_announcement" %>
<% end %>

<div id="hub" class="primary">
  <div id="feeds">
	
		<div class="tabs"> 
			<ul class="tabs-nav">
				<li class="active"><a href="#news_feed">Activity Stream</a></li>
				<li class=""><a href="#following">Following</a></li> 
				<li class=""><a href="#messages">Inbox</a></li> 
			</ul>
		
			<div id="news_feed" class="tabs-panel">
			
				<div id="ask" class="">				  
				  <% form_for :status, :url => statuses_path, :html => {:accept_charset => "utf-8", :id => "widget_status", :class => "labeless"} do |f| -%>
  				  <%= link_to_avatar_for(current_profile, { :thumb => :thumb_80, :hide_status_indicator => true, :hide_sponsor_sash => true, :hide_tooltip => true }) %>
  					<%= f.text_area :body, :maxlength => '140', :placeholder => "Share an Update or Ask a Question" %>
  					
  					<p class="actions">
  					  <input class="button" type="submit" value="Share">
  					  <input type="checkbox" id="status_question" />
  					  <span>Post as a question</span>
  					  <%# MM2: There's some railsness to make this cleaner somewhere %>
              <select name="status[question_category]" id="status_question_category" style="display: none;">
                <% Question.categories.each do |category| %>
                  <option><%= category %></option>
                <% end %>
              </select>
  					</p>				  
				  <% end %>
				</div>
			
			  <% @events.each do |event| -%>
        	<%= render :partial => 'shared/event_stream_item', :locals => { :event => event } -%>
        <% end -%>
			</div> 
			<div id="following" class="tabs-panel" style="display: none;"> 
			  <style>
			    #following a.filter {
			      display: block;
			      float: right;
			      margin: 3px 5px 0 0;
			    }
			  </style>
        <%= link_to "View and Filter All the Things your Following", profile_watches_path(current_profile), :class => "filter" %>
        <h3 class="lead">Things I'm Following</h3>

        <% @followings.each do |event| -%>
        	<%= render :partial => 'shared/event_stream_item', :locals => { :event => event } -%>
        <% end -%>
			</div> 
			<div id="messages" class="tabs-panel" style="display: none;"> 
			  <div style="float: right; margin-right: 10px; margin-top: 8px;">
			    <%= link_to "Send a New Message", new_note_path, :class => "new_message button" %>
			  </div>
			  
			  <h3 class="lead">Private Messages</h3>
			  
				<% @messages.each do |message| %>
				  <% person_of_interest = display_message_person_of_interest(message) %>
				  <div class="list_item news_item">
				    <%= person_of_interest[:img] %>
				    <div class="details">

				      <p class="reply" style="float: right; margin-top: 3px;">
				        <%= link_to "Reply", new_note_path(:reply_to => message.id), :class => "new_message button little" %>
				      </p>

				      <h3 class="who">
				        <%= person_of_interest[:lead] %>
				      </h3>
				      <p class="when">
				        <%= pretty_datetime message.created_at %>
				      </p>
				      <div class="what"><%= message.message %></div>
				    </div>
				  </div>
				<% end %>
			</div>
		</div>
	
	</div>

  <div id="groups" class="module">
		<h2>My Groups</h2>
		<ul class="nav">
			<li><%= link_to "Explore Groups", groups_explorations_path %></li>
			<li><%= link_to "Create a Group", new_group_path, :class => "modal create_group" %></li>
		</ul>
	
		<% @groups.each do |group| %>
			<div id="group140" class="list_item group_item <%= cycle "even", "odd" %>">
				<%= primary_photo_for(group, :thumb => :thumb_80, :linkable => true, :class => "photo", :alt => "#{group.name} avatar", :hide_group_icon => true ) %>

				<div class="details">
					<h3><%= link_to "#{group.name} &nbsp;&nbsp;<small>Founded on #{content_tag("span", short_date(group.created_at),:class => "info")}", group_path(group) %></small></h3>
					<p class="description">
					  <%= truncate(group.description, 200) %>
					</p>
				</div>
			</div>
		<% end %>
	
		<div class="see_all">
		  <%= link_to "See All My Groups", groups_profile_path(current_profile) %>
		</div>
	</div>
</div>


<div class="aside">
	<div id="promotions" class="module">
		<p class="promo_image">
		  <%= marketing_image_tag(@random_marketing_message) -%>
		</p>
	</div>
	<div id="referred_questions" class="module">
	  <% if !@questions_referred_to_me.empty? %>
  		<h2>Referred Questions</h2>
  		<% @questions_referred_to_me.each do |question| %>
				<%= render :partial => "/questions/hub", :locals => { :question => question } %>
  		<% end %>
  	<% else %>
  	  <h2>Latest Question</h2>
			<%= render :partial => "/questions/hub", :locals => { :question => @latest_question } %>  	  
  	<% end %>
	</div>
	<div id="statistics" class="module">
		<h2>Karma (<%= @profile_stats[:karma_points] %>)</h2>
		<table>
			<tr>
				<td><strong>Updates:</strong> <%= @profile_stats[:statuses] %></td>
				<td><strong>Best Answers:</strong> <%= @profile_stats[:best_answers] %></td>
			</tr>
			<tr>
				<td><strong>Questions:</strong> <%= @profile_stats[:questions] %></td>
				<td><strong>Notes:</strong> <%= @profile_stats[:blog_posts] %></td>
			</tr>
			<tr>
				<td><strong>Groups:</strong> <%= @profile_stats[:groups] %></td>
				<td><strong>Profile Views:</strong> <%= @profile_stats[:profile_views] %></td>
			</tr>
		</table>
	</div>
	<div id="blog_posts" class="module">
		<h2>Blog Posts</h2>
		<% @blog_posts.each do |blog_post| %>
			<div class="note">
				<div class="text">
				  <%#= link_to truncate(blog_post.text.gsub(/<\/?[^>]*>/, ""), 140, "&hellip;&nbsp;"), blog_post_path(blog_post) %>
				  <%= textilize truncate(blog_post.text.gsub(/<br\/?>/,"---linebreak---").gsub(/<\/?[^>]*>/, "").gsub("---linebreak---","<br/>"), 140, "&hellip;&nbsp;") %>
				</div>
				<p class="title"><%= link_to blog_post.title, blog_post_path(blog_post) %></p>
				<p class="when"><%= pretty_date blog_post.created_at %></p>
			</div>
		<% end %>
	
		<div class="see_all">
			<a href=<%= blogs_explorations_path %>>See All Blog Posts</a>
		</div>
	</div>

	<div id="widget" class="widget">
		<div class="module last">
      <% (1..@widgets.keys.size).to_a.reverse.each do |idx| %>      
        <%= render_widget @widgets[idx.to_s] -%>
      <% end %>
		</div>
	</div>
	
</div>